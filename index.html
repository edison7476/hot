<!DOCTYPE html>
<html ng-app="myApp">
<!--  I did this using bootstrap modal. It can also be done using Augular ng-view and routing to switch pages-->

<head>
    <meta charset="utf-8">
    <title>Hotel Booking Demo</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.4/ui-bootstrap-tpls.min.js"></script>

    <script src="Controllers/modalController.js"></script>
    <script src="Controllers/roomController.js"></script>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" href="style.css" media="screen" title="no title">
    <script>
        function equalHeight(group) {
          var tallest = 0;
          group.each(function() {
            var thisHeight = $(this).height();
            console.log('thisHeight = ', thisHeight);
            if(thisHeight > tallest) {
                tallest = thisHeight;
            }
          });
        group.each(function() { $(this).height(tallest + 50); });
      }

      jQuery(document).ready(function() {
        equalHeight(jQuery(".caption"));
      });
    </script>
</head>

<body ng-controller="roomController" style="padding-top:20px" class="modal-open">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Brand</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
                    <li><a href="#">Link</a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <!-- currency convert selection -->
                      <div class=" currencySelection">
                        <select ng-model="fromType" class="form-control" required
                                data-ng-change="forExConvert(fromType)"
                                style="display: inline-block"
                                ng-options="key for (key, value) in rates track by value">
                          <option value="">USD -- Select Currency --</option>
                        </select>
                      </div>
                    <!-- End of currency convert selection -->

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>


      <!--  we can put the following code into directvie-->
      <div class="wrap" ng-repeat="room in roomData " ng-hide="$last">
          <div class="col-xs-4 col-sm-4 col-md-4 ">
              <div class="thumbnail">
                  <img src="{{ room.image_url}}" alt="" />
                  <div class="caption">
                      <h4>{{ room.short_desc }}</h4>
                      <p class="long_desc">{{ room.long_desc }}</p>

                        <div class="">
                          <h5 ng-hide="fromType">Price: {{ room.room_price }} /Night (USD) </h5>
                          <h5 ng-show="fromType">Price: {{ room.room_price * fromType | number: 2}} /Night ({{ currency }}) </h5>
                        </div>
                      <a type="button"  class="btn btn-primary " data-toggle="modal" data-target="#guestInfoModal" ng-click="bookRoom(room)">Book Room</a>
                  </div>
              </div>
          </div>
      </div>
      <!--  ############################### -->


<!--  Guest Information Modal -->
      <div ng-controller="roomController" class="modal fade" id="guestInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Booking Information</h4>
                  </div>
                  <div class="modal-body">
                      <form class="form-horizontal" name="bookForm" novalidate>
                          <!--  First Name -->
                          <div class="form-group" ng-class="{ 'has-error': bookForm.first_name.$invalid }">
                              <label for="title" class="col-sm-3 control-label">First Name:</label>
                              <div class="col-sm-9">
                                  <input type="text" name="first_name" class="form-control" placeholder="First Name" ng-model="guest.first_name" ng-minlength='2' required>
                                  <span ng-show='bookForm.first_name.$touched && bookForm.first_name.$error.required' style="color:red">Name field cannot be empty!</span>
                                  <span ng-show='bookForm.first_name.$touched && bookForm.first_name.$error.minlength' style="color:red">First name must have at least 2 chars!</span>
                              </div>
                          </div>
                          <!--  Last Name -->
                          <div class="form-group" ng-class="{ 'has-error': bookForm.last_name.$invalid }" >
                              <label for="title" class="col-sm-3 control-label">Last Name:</label>
                              <div class="col-sm-9">
                                  <input type="text" name="last_name" class="form-control" placeholder="Last Name" ng-model="guest.last_name" ng-minlength='2' required>
                                  <span ng-show='bookForm.last_name.$touched && bookForm.last_name.$error.required' style="color:red">Name field cannot be empty!</span>
                                  <span ng-show='bookForm.last_name.$touched && bookForm.last_name.$error.minlength' style="color:red">Last name must have at least 2 chars!</span>
                              </div>
                          </div>
                          <!--  Email -->
                          <div class="form-group" ng-class="{ 'has-error': bookForm.email.$invalid }">
                              <label for="" class="col-sm-3 control-label">Email:</label>
                              <div class="col-sm-9">
                                  <input class="form-control" name="email" placeholder="Email" type="text" ng-model="guest.email" ng-pattern="/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/" required>
                                  <span ng-show='bookForm.email.$touched && bookForm.email.$error.required' style="color:red">Email field cannot be empty!</span>
                                  <span ng-show='bookForm.email.$touched && bookForm.email.$error.pattern' style="color:red">Not a valid email! Please provide a valid email.</span>
                              </div>
                          </div><!--  End of Email section-->

                          <div class="form-group" ng-class="{ 'has-error': bookForm.date.$invalid }">
                            <label class="col-sm-3 control-label">Check-In Date: </label>
                            <div class="col-sm-9">
                              <input class="form-control" type="date" name="date" ng-model="guest.checkInDate" min="{{ today | date:'yyyy-MM-dd'}}" required>
                              <span ng-show="bookForm.date.$touched && bookForm.date.$error.required" style="color:red">Please select the Check-Out date.</span>
                              <span ng-show="bookForm.date.$error.min" style="color:red">Please enter a date on or after the current date.</span>
                            </div>
                          </div>

                          <div class="form-group" ng-class="{ 'has-error': bookForm.checkOutDate.$invalid }">
                            <label class="col-sm-3 control-label">Check-Out Date: </label>
                            <div class="col-sm-9">
                              <input class="form-control" type="date" name="checkOutDate" ng-model="guest.checkOutDate" min="{{ guest.checkOutMinDate | date:'yyyy-MM-dd'}}" ng-click="checkOut(guest)" required>
                              <span ng-show="bookForm.checkOutDate.$error.min" style="color:red">The Check-Out date must be after the selected Check-In Date</span>
                            </div>
                          </div>
                          <div class="form-group">
                              <div class="col-sm-12">
                                  <button ng-hide="bookForm.$invalid" type="button" class="btn btn-warning pull-right" ng-click='confirmRoom(guest)' data-dismiss="modal" data-toggle="modal" data-target="#confirmationModal">Book</button>
                              </div>
                          </div>
                      </form>
                  </div>
              </div>
          </div>
      </div>
      <!--  End of Guest Information Modal -->

      <!--  Booking Confirmation Modal -->
      <div ng-controller="roomController" class="modal fade upgradeModal" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Booked Room Information</h4>
                  </div>
                  <div class="modal-body">
                      <img class="col-sm-3 col-md-3" src="{{bookingInfo.roomInfo.image_url}}" alt="" />
                      <div class="col-sm-4 col-md-4">
                          <p>Guest Name: </p>
                          <p>Room Type: </p>
                          <p>Check In: </p>
                          <p>Check Out: </p>
                          <p ng-if="bookingInfo.ChampagneStrawberries.room_price">Champagne&Strawberries:</p>
                          <p >Total Price: </p>
                      </div>
                      <div class="col-sm-5 col-md-5">
                          <!-- Display booking information guest name, room type, price-->
                          <p>{{ bookingInfo.guestInfo.first_name | uppercase }} {{ bookingInfo.guestInfo.last_name | uppercase }}</p>
                          <p>{{ bookingInfo.roomInfo.short_desc }}</p>
                          <p>{{ bookingInfo.guestInfo.checkInDate | date }}</p>
                          <p>{{ bookingInfo.guestInfo.checkOutDate| date }}</p>
                          <p ng-if="bookingInfo.ChampagneStrawberries.room_price">
                            <span ng-hide="fromType">{{ bookingInfo.ChampagneStrawberries.room_price }} (USD)<a  href="" style="color:red" class="close" ng-click="remove()">x</a></span>
                            <span ng-show="fromType">{{ bookingInfo.ChampagneStrawberries.room_price * fromType | number: 2}} ({{currency}})<a  href="" style="color:red" class="close" ng-click="remove()">x</a></span>
                          </p>
                          <p ng-hide="fromType">{{ bookingInfo.roomInfo.room_price * ( (bookingInfo.guestInfo.checkOutDate - bookingInfo.guestInfo.checkInDate)/86400000 ) + bookingInfo.ChampagneStrawberries.room_price }} (USD) </p>
                          <p ng-show="fromType">{{ fromType * (bookingInfo.roomInfo.room_price * ( (bookingInfo.guestInfo.checkOutDate - bookingInfo.guestInfo.checkInDate)/86400000 ) + bookingInfo.ChampagneStrawberries.room_price ) | number: 2}} ({{ currency }})  </p>
                      </div>

  <!--  upgrade options-->
                      <table class="table table-hover" ng-repeat="upgradeOption in roomData">
                          <tr ng-show="(upgradeOption.item_id > bookingInfo.roomInfo.item_id) && (upgradeOption.item_id < 103)">
                              <td><img src="{{ upgradeOption.image_url}}" alt="" /></td>
                              <td colspan="2">Upgrade to {{ upgradeOption.room_code}} room for only {{ upgradeOption.price}}</td>
                              <td>
                                  <button type="button" class="btn btn-info btn-sm pull-right" ng-click='upgrade(upgradeOption)'>Upgrade</button>
                              </td>
                          </tr>
                          <tr ng-show="(upgradeOption.item_id < bookingInfo.roomInfo.item_id) && (upgradeOption.item_id < 103)">
                            <td><img src="{{ upgradeOption.image_url}}" alt="" /></td>
                              <td colspan="3" style="color:red"><a href="" ng-click='upgrade(upgradeOption)'>I would like to check {{ upgradeOption.room_code}} room</a>
                          </tr>
                          <tr ng-show="(upgradeOption.item_id == 103 && (bookingInfo.roomInfo.room_price * ((bookingInfo.guestInfo.checkOutDate - bookingInfo.guestInfo.checkInDate)/86400000 )) > 199) && !bookingInfo.ChampagneStrawberries.room_price">
                            <td><img src="{{ upgradeOption.image_url}}" alt="" /></td>
                              <td colspan="2">Add {{ upgradeOption.short_desc}} for {{ upgradeOption.price}} </td>
                              <td>
                                  <button type="button" class="btn btn-info btn-sm pull-right" ng-click='add(upgradeOption)'>Add</button>
                              </td>
                          </tr>
                      </table>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-warning pull-right" ng-click='finalConfirm(bookingInfo)' data-dismiss="modal" data-toggle="modal" data-target="#finalConfirmModal">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <!--  End of Booking confirmation Modal -->

      <!--  Final confirmation Modal -->
      <div ng-controller="roomController" class="modal fade" id="finalConfirmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
              <div class="modal-content" id="printModalContent">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Confirmation</h4>
                  </div>
                  <div class="modal-body">
                      <img class="col-sm-4" src="{{bookingInfo.roomInfo.image_url}}" alt="" />
                      <h4>Thank you for choosing our hotel </h4>
                      <div class="col-sm-3">
                          <p>Guest Name: </p>
                          <p>Room Type: </p>
                          <p>Check In: </p>
                          <p>Check Out: </p>
                          <p>Total Price: </p>
                      </div>
                      <div class="col-sm-5">
                          <!-- Display booking information guest name, room type, price-->
                          <p>{{ bookingInfo.guestInfo.first_name }} {{ bookingInfo.guestInfo.last_name}}</p>
                          <p>{{ bookingInfo.roomInfo.short_desc }}</p>
                          <p>{{ bookingInfo.guestInfo.checkInDate | date }}</p>
                          <p>{{ bookingInfo.guestInfo.checkOutDate| date }}</p>
                          <p ng-hide="fromType">{{ (bookingInfo.roomInfo.room_price * ((bookingInfo.guestInfo.checkOutDate - bookingInfo.guestInfo.checkInDate)/86400000))+ bookingInfo.ChampagneStrawberries.room_price }} (USD) </p>
                          <p ng-show="fromType">{{ fromType * (bookingInfo.roomInfo.room_price * ( (bookingInfo.guestInfo.checkOutDate - bookingInfo.guestInfo.checkInDate)/86400000 ) + bookingInfo.ChampagneStrawberries.room_price ) | number: 2}} ({{ currency }}) </p>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-danger pull-right" data-dismiss="modal">Finish</button>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!--  End of final confirmation Modal -->
      <div class="container">
      </div>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</body>

</html>
